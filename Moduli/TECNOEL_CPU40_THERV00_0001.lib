//*************************************************************************************************
//************** Task Termostato Sonda Carel Pannello Radiante Schedulato
//************** Task Termostato Pannello Radiente su uscita PLC Controller
//*************************************************************************************************

/*** BeginHeader  TaskTherV00,TaskTherV00Init*/
void TaskTherV00();
void TaskTherV00_Init();
/*** EndHeader  */

unsigned int TaskTherV00_PC;
unsigned int TaskTherV00_Timer00;
unsigned int TaskTherV00_Counter1;
unsigned int TaskTherV00_Counter2;

void TaskTherV00_Init()
{
 TaskTherV00_PC=0;
 TaskTherV00_Timer00=BiosIOGetNewTimer();
 TaskTherV00_Counter1=0;
 TaskTherV00_Counter2=0;
}

void TaskTherV00_00()
{
 #ifdef DEBUG
 printf("Check Thermo Status 1\n");
 #endif
 if (!BiosIOGetBitFlag(FLAG_THER_FLLIB1))
  {
  if (BiosIOGetBitReg(SCHE_VFLAGS,1) || !BiosIOGetBitFlag(FLAG_THER_FLSCH1))
   {
   if (BiosIOGetBitFlag(FLAG_THER_FLEST1))
   {if (BiosIOGetReg(THER_SETTM1)<BiosIOGetReg(MODB_CA1TVA)) BiosIOSetBitFlag(FLAG_THER_FLCIR1,1); else BiosIOSetBitFlag(FLAG_THER_FLCIR1,0);}
   else
   {if (BiosIOGetReg(THER_SETTM1)>BiosIOGetReg(MODB_CA1TVA)) BiosIOSetBitFlag(FLAG_THER_FLCIR1,1); else BiosIOSetBitFlag(FLAG_THER_FLCIR1,0);}
   }
  else
   {
   BiosIOSetBitFlag(FLAG_THER_FLCIR1,0);
   }
  }
 if (BiosIOGetBitFlag(FLAG_THER_FLCIR1))
  {
  if (TaskTherV00_Counter1>=6)
   {
   BiosIOAddReg(THER_CIRCM1,1);
   if (BiosIOGetReg(THER_CIRCM1)>=60) {BiosIOSetReg(THER_CIRCM1,0); BiosIOAddReg(THER_CIRCH1,1);}
   TaskTherV00_Counter1=0;
   }
  TaskTherV00_Counter1++;
  }
 //BiosIOSetOutput(OUTPUT_1,BiosIOGetBitFlag(FLAG_THER_FLCIR1));
 //BiosIOSetBitReg(MODB_SX0000,1,BiosIOGetBitFlag(FLAG_THER_CIR1));
 //BiosIOSetBitReg(SYST_OUTPU0,0,BiosIOGetBitFlag(FLAG_THER_FLCIR1));
 TaskScenV00_SetChOutput(BiosIOGetReg(THER_ASSOU1),BiosIOGetBitFlag(FLAG_THER_FLCIR1));
 BiosIOSetTimer(TaskTherV00_Timer00,100);
 TaskTherV00_PC=1;
}

void TaskTherV00_01()
{
 #ifdef DEBUG
 printf("Check Thermo Status 2\n");
 #endif
 if (!BiosIOGetBitFlag(FLAG_THER_FLLIB2))
  {
  if (BiosIOGetBitReg(SCHE_VFLAGS,1) || !BiosIOGetBitFlag(FLAG_THER_FLSCH2))
   {
   if (BiosIOGetBitFlag(FLAG_THER_FLEST2))
   {if (BiosIOGetReg(THER_SETTM2)<BiosIOGetReg(MODB_CA2TVA)) BiosIOSetBitFlag(FLAG_THER_FLCIR2,1); else BiosIOSetBitFlag(FLAG_THER_FLCIR2,0);}
   else
   {if (BiosIOGetReg(THER_SETTM2)>BiosIOGetReg(MODB_CA2TVA)) BiosIOSetBitFlag(FLAG_THER_FLCIR2,1); else BiosIOSetBitFlag(FLAG_THER_FLCIR2,0);}
   }
  else
   {
   BiosIOSetBitFlag(FLAG_THER_FLCIR2,0);
   }
  }
 if (BiosIOGetBitFlag(FLAG_THER_FLCIR2))
  {
  if (TaskTherV00_Counter2>=6)
   {
   BiosIOAddReg(THER_CIRCM2,1);
   if (BiosIOGetReg(THER_CIRCM2)>=60) {BiosIOSetReg(THER_CIRCM2,0); BiosIOAddReg(THER_CIRCH2,1);}
   TaskTherV00_Counter2=0;
   }
  TaskTherV00_Counter2++;
  }
 //BiosIOSetOutput(OUTPUT_2,BiosIOGetBitFlag(FLAG_THER_FLCIR2));
 //BiosIOSetBitReg(MODB_SX0000,1,BiosIOGetBitFlag(FLAG_THER_CIR2));
 //BiosIOSetBitReg(SYST_OUTPU0,1,BiosIOGetBitFlag(FLAG_THER_FLCIR2));
 TaskScenV00_SetChOutput(BiosIOGetReg(THER_ASSOU2),BiosIOGetBitFlag(FLAG_THER_FLCIR2));
 BiosIOSetTimer(TaskTherV00_Timer00,100);
 TaskTherV00_PC=2;
}

void TaskTherV00_02()
{
 if (BiosIOGetTimer(TaskTherV00_Timer00)) TaskTherV00_PC=0;
}

void TaskTherV00()
{
 switch (TaskTherV00_PC)
  							{
 							case 0: {TaskTherV00_00(); break;}
   						case 1: {TaskTherV00_01(); break;}
   						case 2: {TaskTherV00_02(); break;}
							}
}




